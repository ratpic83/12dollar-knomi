# Example Klipper printer.cfg snippet
# Shows how to integrate Knomi Clone with your existing configuration

# ============================================================================
# Include Knomi Configuration
# ============================================================================
# Add this near the top of your printer.cfg with other includes

[include knomi.cfg]

# ============================================================================
# Example: Integration with Existing Macros
# ============================================================================

# If you already have a PRINT_START macro, modify it like this:
[gcode_macro PRINT_START]
gcode:
    # Existing code...
    KNOMI_STATUS MSG="Heating bed..."
    M140 S{params.BED_TEMP}
    
    KNOMI_STATUS MSG="Heating hotend..."
    M104 S{params.EXTRUDER_TEMP}
    
    KNOMI_STATUS MSG="Homing..."
    G28
    
    KNOMI_STATUS MSG="Bed leveling..."
    BED_MESH_CALIBRATE
    
    KNOMI_STATUS MSG="Purging..."
    # Your purge line code here
    
    KNOMI_STATUS MSG="Printing..."
    # Continue with print

# If you already have a PRINT_END macro:
[gcode_macro PRINT_END]
gcode:
    KNOMI_STATUS MSG="Print complete!"
    # Your existing end code...
    M104 S0  # Turn off hotend
    M140 S0  # Turn off bed
    G28 X Y  # Home X and Y
    M84      # Disable motors

# ============================================================================
# Example: Custom Status Messages
# ============================================================================

[gcode_macro LOAD_FILAMENT]
gcode:
    KNOMI_STATUS MSG="Loading filament..."
    M83  # Extruder relative mode
    G1 E50 F300  # Extrude 50mm
    KNOMI_STATUS MSG="Filament loaded"

[gcode_macro UNLOAD_FILAMENT]
gcode:
    KNOMI_STATUS MSG="Unloading filament..."
    M83  # Extruder relative mode
    G1 E-50 F300  # Retract 50mm
    KNOMI_STATUS MSG="Filament unloaded"

# ============================================================================
# Example: Error Handling
# ============================================================================

[gcode_macro HANDLE_PRINT_ERROR]
gcode:
    KNOMI_STATUS MSG="ERROR!"
    PAUSE
    M117 Print error detected

# ============================================================================
# Example: Multi-Material Setup (if applicable)
# ============================================================================

[gcode_macro T0]
gcode:
    KNOMI_STATUS MSG="Tool 0"
    # Your tool change code

[gcode_macro T1]
gcode:
    KNOMI_STATUS MSG="Tool 1"
    # Your tool change code

# ============================================================================
# Example: Maintenance Macros
# ============================================================================

[gcode_macro PREHEAT_PLA]
gcode:
    KNOMI_STATUS MSG="Preheating PLA"
    M140 S60
    M104 S200

[gcode_macro PREHEAT_PETG]
gcode:
    KNOMI_STATUS MSG="Preheating PETG"
    M140 S80
    M104 S240

[gcode_macro PREHEAT_ABS]
gcode:
    KNOMI_STATUS MSG="Preheating ABS"
    M140 S100
    M104 S245

# ============================================================================
# Example: Bed Mesh Visualization
# ============================================================================

[gcode_macro BED_MESH_CALIBRATE]
rename_existing: BED_MESH_CALIBRATE_BASE
gcode:
    KNOMI_STATUS MSG="Probing bed..."
    SET_GCODE_VARIABLE MACRO=BedLevelVar VARIABLE=leveling VALUE=True
    BED_MESH_CALIBRATE_BASE {rawparams}
    SET_GCODE_VARIABLE MACRO=BedLevelVar VARIABLE=leveling VALUE=False
    KNOMI_STATUS MSG="Bed mesh complete"

# ============================================================================
# Example: Z-Offset Calibration
# ============================================================================

[gcode_macro Z_OFFSET_CALIBRATE]
gcode:
    KNOMI_STATUS MSG="Z offset calibration"
    G28
    PROBE_CALIBRATE

# ============================================================================
# Example: Input Shaper Calibration
# ============================================================================

[gcode_macro SHAPER_CALIBRATE]
rename_existing: SHAPER_CALIBRATE_BASE
gcode:
    KNOMI_STATUS MSG="Shaper calibration"
    SHAPER_CALIBRATE_BASE {rawparams}
    KNOMI_STATUS MSG="Calibration complete"

# ============================================================================
# Notes:
# ============================================================================
# 
# 1. The KNOMI_STATUS macro sends messages that can be displayed
#    Currently it uses M117, but future versions may show on Knomi display
# 
# 2. The BedLevelVar and HomeSetVar variables are automatically updated
#    by the included knomi.cfg when homing or leveling
# 
# 3. You can check these variables in your macros:
#    {% if printer["gcode_macro HomeSetVar"].homing %}
#        # Printer is currently homing
#    {% endif %}
# 
# 4. All standard Klipper objects are automatically monitored:
#    - extruder (hotend temperature)
#    - heater_bed (bed temperature)
#    - print_stats (print state, progress)
#    - gcode_move (position, speeds)
#    - fan (part cooling fan)
# 
# 5. If you have additional sensors (chamber, etc.), they should
#    automatically be detected if named correctly in your config
